{"version":3,"sources":["D:\\Website Projects\\ooley\\src\\roomStyle.css","D:\\Website Projects\\ooley\\node_modules\\css-loader\\dist\\runtime\\api.js","D:\\Website Projects\\ooley\\node_modules\\css-loader\\dist\\runtime\\cssWithMappingToString.js","D:\\Website Projects\\ooley\\node_modules\\style-loader\\dist\\runtime\\injectStylesIntoStyleTag.js","webpack/bootstrap","webpack/runtime/compat get default export","webpack/runtime/define property getters","webpack/runtime/hasOwnProperty shorthand","D:\\Website Projects\\ooley\\src\\networkManager.ts","D:\\Website Projects\\ooley\\src\\util.ts","D:\\Website Projects\\ooley\\src\\dp_iter.ts","webpack://networking/./src/roomStyle.css?0c69","D:\\Website Projects\\ooley\\src\\room.ts"],"names":["___CSS_LOADER_EXPORT___","push","module","id","exports","cssWithMappingToString","list","toString","this","map","item","content","concat","join","i","modules","mediaQuery","dedupe","alreadyImportedModules","length","_i","_arrayLikeToArray","arr","len","arr2","Array","_item","isArray","_arrayWithHoles","Symbol","iterator","Object","_arr","_n","_d","_e","undefined","_s","next","done","value","err","_iterableToArrayLimit","o","minLen","n","prototype","call","slice","constructor","name","from","test","_unsupportedIterableToArray","TypeError","_nonIterableRest","cssMapping","btoa","base64","unescape","encodeURIComponent","JSON","stringify","data","sourceMapping","sourceURLs","sources","source","sourceRoot","memo","getTarget","target","styleTarget","document","querySelector","window","HTMLIFrameElement","contentDocument","head","e","stylesInDom","getIndexByIdentifier","identifier","result","modulesToDom","options","idCountMap","identifiers","base","count","index","obj","css","media","sourceMap","references","updater","addStyle","insertStyleElement","style","createElement","attributes","nonce","keys","forEach","key","setAttribute","insert","Error","appendChild","textStore","replaceText","replacement","filter","Boolean","applyToSingletonTag","remove","styleSheet","cssText","cssNode","createTextNode","childNodes","removeChild","insertBefore","applyToTag","removeAttribute","firstChild","singleton","singletonCounter","update","styleIndex","bind","parentNode","removeStyleElement","newObj","all","atob","lastIdentifiers","newList","newLastIdentifiers","_index","splice","__webpack_module_cache__","__webpack_require__","moduleId","__webpack_modules__","getter","__esModule","d","a","definition","defineProperty","enumerable","get","prop","hasOwnProperty","UInt8","PEER_CONNECTION_CONFIG","iceServers","urls","username","credential","NetworkManager","_buffer","ArrayBuffer","buffer","DataView","rpcs","signature","func","objectTypes","constr","rpcLog","users","userId","mode","signalingConnection","connectingPromise","sendLoopTimeout","invalid","lastTime","onUserConnected","console","log","onUserDisconnected","onSyncCompleted","_instance","setTimeout","sendLoop","setupSignalingServer","error","Promise","resolve","reject","signalCon","WebSocket","onmessage","async","event","message","parse","ind","findIndex","user","_uuid","uuid","roomCreated","roomId","ice","_peerCon","addIceCandidate","RTCIceCandidate","sdpOffer","con","RTCPeerConnection","syncing","rpcLogInd","objects","tcpCon","udpCon","onicecandidate","candidate","readyState","send","setRemoteDescription","RTCSessionDescription","_setupTracks","setLocalDescription","createAnswer","sdpAnswer","localDescription","readyHandler","oniceconnectionstatechange","iceConnectionState","disconnectUser","onopen","onclose","onerror","_","startHost","createDataChannel","ordered","negotiated","maxRetransmits","binaryType","evt","createUuid","_decodeRPC","createOffer","s4","Math","floor","random","substring","objType","args","_spawn","sendRPC","encodeRPC","_objId","_ownerId","onSpawn","fn","objConstr","_classId","to","byteOffset","byteLength","amt","j","bufferedAmount","sendRPCAll","ownerId","objId","rpcId","setUint8","setUint16","_writeToBuf","close","callingUserId","getUint8","getUint16","_readFromBuf","types","output","getFloat64","items","Number","String","s","fromCharCode","setFloat64","charCodeAt","IRPC","propertyKey","descriptor","manager","instance","orig","clientId","registerRPC","serverId","Vec2","x","y","dx","dy","Color","r","g","b","t","lerp","min","max","PointLineDistance","point","p1","p2","segmentLength","sqr_dist","sqrt","canvas","getElementById","context","getContext","colors","setup","width","innerWidth","height","innerHeight","lineJoin","lineCap","lineWidth","addEventListener","Stroke","color","rainbow","points","isDrawing","colorInd","colorTime","dt","col","nextCol","strokeStyle","toColorString","beginPath","moveTo","lineTo","stroke","_addPoint","smooth","epsilon","bitArray","startIndex","lastIndex","stk","globalStartIndex","fill","pair","pop","dmax","_DouglasPeucker","resList","DouglasPeucker","samples","i_add","i_div_s","managers","renderLoop","timestamp","clearRect","requestAnimationFrame","DrawingManager","paths","activePath","widthSlider","colorInput","rainbowButton","mousePos","mouseDown","offsetX","offsetY","mouseUp","getCoalescedEvents","events","mouseMove","onclick","toggleRainbow","undo","clear","ctrlKey","classList","add","parseInt","newPath","substr","draw","fillStyle","arc","PI","registerNetworkedObject","newConst","spawn","Replicated","statusDiv","preloader","controls","hostIFrame","isNew","contentWindow","location","reload","src","href","display","body","append","onload","then","parent","startedHost","startClient","textContent","connect","navigator","clipboard","writeText","hostname","click","catch","urlParams","URLSearchParams","search","isHost","localStorage","getItem"],"mappings":"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","file":"room.bundle.js","sourcesContent":["// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../node_modules/css-loader/dist/runtime/cssWithMappingToString.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"* {\\r\\n    margin: 0;\\r\\n    padding: 0;\\r\\n    -webkit-tap-highlight-color: transparent;\\r\\n}\\r\\n\\r\\nbutton:focus,\\r\\ninput:focus,\\r\\ntextarea:focus,\\r\\nselect:focus,\\r\\n#controls input:focus {\\r\\n    outline: none;\\r\\n    border: 1px solid #1a73e8;\\r\\n    border-radius: 5px;\\r\\n}\\r\\n\\r\\nhtml,\\r\\nbody {\\r\\n    height: 100%;\\r\\n    position: relative;\\r\\n}\\r\\n\\r\\nbody {\\r\\n    background: #ffffff;\\r\\n    cursor: crosshair;\\r\\n}\\r\\n\\r\\n#preloader {\\r\\n    display: flex;\\r\\n    position: absolute;\\r\\n    z-index: 2;\\r\\n    top: 50%;\\r\\n    left: 50%;\\r\\n    transform: translate3d(-50%, -50%, 0);\\r\\n    transition: opacity 1s, visibility 1s step-end;\\r\\n    user-select: none;\\r\\n    -moz-user-select: none;\\r\\n    -khtml-user-select: none;\\r\\n    -webkit-user-select: none;\\r\\n    -o-user-select: none;\\r\\n    cursor: crosshair;\\r\\n}\\r\\n\\r\\n#chatbox {\\r\\n    height: 300px;\\r\\n    width: 250px;\\r\\n    border: 1px solid black;\\r\\n    overflow-y: auto;\\r\\n    margin: 10px;\\r\\n    margin-left: 0;\\r\\n}\\r\\n\\r\\n@keyframes bounce {\\r\\n    0% {\\r\\n        transform: translateY(-120px);\\r\\n    }\\r\\n\\r\\n    75% {\\r\\n        transform: scaleY(0.9);\\r\\n    }\\r\\n\\r\\n    100% {\\r\\n        transform: translateY(0);\\r\\n    }\\r\\n}\\r\\n\\r\\n.first-o {\\r\\n    width: 123px;\\r\\n    transform: translateY(-120px);\\r\\n    animation: bounce 0.5s 0.15s cubic-bezier(0.5, 0.05, 1, 0.5) infinite\\r\\n        alternate;\\r\\n}\\r\\n\\r\\n.second-o {\\r\\n    margin-left: 8px;\\r\\n    width: 90px;\\r\\n    animation: bounce 0.5s cubic-bezier(0.5, 0.05, 1, 0.5) infinite alternate;\\r\\n}\\r\\n\\r\\n#preloader.hidden,\\r\\n.hidden {\\r\\n    opacity: 0;\\r\\n    visibility: hidden;\\r\\n}\\r\\n\\r\\n#controls.visible,\\r\\n.visible {\\r\\n    opacity: 1;\\r\\n    visibility: visible;\\r\\n}\\r\\n\\r\\ncanvas {\\r\\n    display: block;\\r\\n    width: 100vw;\\r\\n    height: 100vh;\\r\\n    visibility: visible;\\r\\n    opacity: 1;\\r\\n    cursor: crosshair;\\r\\n    touch-action: none;\\r\\n    transition: opacity 1s, visibility 1s step-start;\\r\\n}\\r\\n\\r\\n#rainbow {\\r\\n    color: #de3618;\\r\\n}\\r\\n\\r\\n#rainbow.rainbowOn {\\r\\n    color: #50b83c;\\r\\n}\\r\\n\\r\\n#controls {\\r\\n    opacity: 0;\\r\\n    visibility: hidden;\\r\\n    transition: opacity 1s, visibility 1s step-start;\\r\\n}\\r\\n\\r\\n#controls input {\\r\\n    border: 1px solid transparent;\\r\\n    padding: 0;\\r\\n    width: 100%;\\r\\n}\\r\\n\\r\\n.controls-container {\\r\\n    font-family: Helvetica, Arial, sans-serif;\\r\\n    position: absolute;\\r\\n    z-index: 2;\\r\\n    width: 130px;\\r\\n    top: 20px;\\r\\n    left: 20px;\\r\\n}\\r\\n\\r\\ncanvas:active {\\r\\n    border-color: royalblue;\\r\\n}\\r\\n\\r\\nbutton {\\r\\n    font-family: Helvetica, sans-serif;\\r\\n    font-size: 14px;\\r\\n\\r\\n    width: 100%;\\r\\n    margin: 10px 0 0 0;\\r\\n    padding: 7px;\\r\\n\\r\\n    background-color: #ffffff;\\r\\n    color: #1a73e8;\\r\\n    border: 1px solid #dadce0;\\r\\n    border-radius: 5px;\\r\\n    transition: background-color 0.1s;\\r\\n    transition: border-color 0.1s;\\r\\n}\\r\\n\\r\\nbutton:hover {\\r\\n    background-color: #f4f8fe;\\r\\n    color: #1a73e8;\\r\\n    border-color: #1a73e8;\\r\\n    cursor: pointer;\\r\\n}\\r\\n\\r\\n#widthSlider {\\r\\n    width: 100%;\\r\\n}\\r\\n\", \"\",{\"version\":3,\"sources\":[\"webpack://src/roomStyle.css\"],\"names\":[],\"mappings\":\"AAAA;IACI,SAAS;IACT,UAAU;IACV,wCAAwC;AAC5C;;AAEA;;;;;IAKI,aAAa;IACb,yBAAyB;IACzB,kBAAkB;AACtB;;AAEA;;IAEI,YAAY;IACZ,kBAAkB;AACtB;;AAEA;IACI,mBAAmB;IACnB,iBAAiB;AACrB;;AAEA;IACI,aAAa;IACb,kBAAkB;IAClB,UAAU;IACV,QAAQ;IACR,SAAS;IACT,qCAAqC;IACrC,8CAA8C;IAC9C,iBAAiB;IACjB,sBAAsB;IACtB,wBAAwB;IACxB,yBAAyB;IACzB,oBAAoB;IACpB,iBAAiB;AACrB;;AAEA;IACI,aAAa;IACb,YAAY;IACZ,uBAAuB;IACvB,gBAAgB;IAChB,YAAY;IACZ,cAAc;AAClB;;AAEA;IACI;QACI,6BAA6B;IACjC;;IAEA;QACI,sBAAsB;IAC1B;;IAEA;QACI,wBAAwB;IAC5B;AACJ;;AAEA;IACI,YAAY;IACZ,6BAA6B;IAC7B;iBACa;AACjB;;AAEA;IACI,gBAAgB;IAChB,WAAW;IACX,yEAAyE;AAC7E;;AAEA;;IAEI,UAAU;IACV,kBAAkB;AACtB;;AAEA;;IAEI,UAAU;IACV,mBAAmB;AACvB;;AAEA;IACI,cAAc;IACd,YAAY;IACZ,aAAa;IACb,mBAAmB;IACnB,UAAU;IACV,iBAAiB;IACjB,kBAAkB;IAClB,gDAAgD;AACpD;;AAEA;IACI,cAAc;AAClB;;AAEA;IACI,cAAc;AAClB;;AAEA;IACI,UAAU;IACV,kBAAkB;IAClB,gDAAgD;AACpD;;AAEA;IACI,6BAA6B;IAC7B,UAAU;IACV,WAAW;AACf;;AAEA;IACI,yCAAyC;IACzC,kBAAkB;IAClB,UAAU;IACV,YAAY;IACZ,SAAS;IACT,UAAU;AACd;;AAEA;IACI,uBAAuB;AAC3B;;AAEA;IACI,kCAAkC;IAClC,eAAe;;IAEf,WAAW;IACX,kBAAkB;IAClB,YAAY;;IAEZ,yBAAyB;IACzB,cAAc;IACd,yBAAyB;IACzB,kBAAkB;IAClB,iCAAiC;IACjC,6BAA6B;AACjC;;AAEA;IACI,yBAAyB;IACzB,cAAc;IACd,qBAAqB;IACrB,eAAe;AACnB;;AAEA;IACI,WAAW;AACf\",\"sourcesContent\":[\"* {\\r\\n    margin: 0;\\r\\n    padding: 0;\\r\\n    -webkit-tap-highlight-color: transparent;\\r\\n}\\r\\n\\r\\nbutton:focus,\\r\\ninput:focus,\\r\\ntextarea:focus,\\r\\nselect:focus,\\r\\n#controls input:focus {\\r\\n    outline: none;\\r\\n    border: 1px solid #1a73e8;\\r\\n    border-radius: 5px;\\r\\n}\\r\\n\\r\\nhtml,\\r\\nbody {\\r\\n    height: 100%;\\r\\n    position: relative;\\r\\n}\\r\\n\\r\\nbody {\\r\\n    background: #ffffff;\\r\\n    cursor: crosshair;\\r\\n}\\r\\n\\r\\n#preloader {\\r\\n    display: flex;\\r\\n    position: absolute;\\r\\n    z-index: 2;\\r\\n    top: 50%;\\r\\n    left: 50%;\\r\\n    transform: translate3d(-50%, -50%, 0);\\r\\n    transition: opacity 1s, visibility 1s step-end;\\r\\n    user-select: none;\\r\\n    -moz-user-select: none;\\r\\n    -khtml-user-select: none;\\r\\n    -webkit-user-select: none;\\r\\n    -o-user-select: none;\\r\\n    cursor: crosshair;\\r\\n}\\r\\n\\r\\n#chatbox {\\r\\n    height: 300px;\\r\\n    width: 250px;\\r\\n    border: 1px solid black;\\r\\n    overflow-y: auto;\\r\\n    margin: 10px;\\r\\n    margin-left: 0;\\r\\n}\\r\\n\\r\\n@keyframes bounce {\\r\\n    0% {\\r\\n        transform: translateY(-120px);\\r\\n    }\\r\\n\\r\\n    75% {\\r\\n        transform: scaleY(0.9);\\r\\n    }\\r\\n\\r\\n    100% {\\r\\n        transform: translateY(0);\\r\\n    }\\r\\n}\\r\\n\\r\\n.first-o {\\r\\n    width: 123px;\\r\\n    transform: translateY(-120px);\\r\\n    animation: bounce 0.5s 0.15s cubic-bezier(0.5, 0.05, 1, 0.5) infinite\\r\\n        alternate;\\r\\n}\\r\\n\\r\\n.second-o {\\r\\n    margin-left: 8px;\\r\\n    width: 90px;\\r\\n    animation: bounce 0.5s cubic-bezier(0.5, 0.05, 1, 0.5) infinite alternate;\\r\\n}\\r\\n\\r\\n#preloader.hidden,\\r\\n.hidden {\\r\\n    opacity: 0;\\r\\n    visibility: hidden;\\r\\n}\\r\\n\\r\\n#controls.visible,\\r\\n.visible {\\r\\n    opacity: 1;\\r\\n    visibility: visible;\\r\\n}\\r\\n\\r\\ncanvas {\\r\\n    display: block;\\r\\n    width: 100vw;\\r\\n    height: 100vh;\\r\\n    visibility: visible;\\r\\n    opacity: 1;\\r\\n    cursor: crosshair;\\r\\n    touch-action: none;\\r\\n    transition: opacity 1s, visibility 1s step-start;\\r\\n}\\r\\n\\r\\n#rainbow {\\r\\n    color: #de3618;\\r\\n}\\r\\n\\r\\n#rainbow.rainbowOn {\\r\\n    color: #50b83c;\\r\\n}\\r\\n\\r\\n#controls {\\r\\n    opacity: 0;\\r\\n    visibility: hidden;\\r\\n    transition: opacity 1s, visibility 1s step-start;\\r\\n}\\r\\n\\r\\n#controls input {\\r\\n    border: 1px solid transparent;\\r\\n    padding: 0;\\r\\n    width: 100%;\\r\\n}\\r\\n\\r\\n.controls-container {\\r\\n    font-family: Helvetica, Arial, sans-serif;\\r\\n    position: absolute;\\r\\n    z-index: 2;\\r\\n    width: 130px;\\r\\n    top: 20px;\\r\\n    left: 20px;\\r\\n}\\r\\n\\r\\ncanvas:active {\\r\\n    border-color: royalblue;\\r\\n}\\r\\n\\r\\nbutton {\\r\\n    font-family: Helvetica, sans-serif;\\r\\n    font-size: 14px;\\r\\n\\r\\n    width: 100%;\\r\\n    margin: 10px 0 0 0;\\r\\n    padding: 7px;\\r\\n\\r\\n    background-color: #ffffff;\\r\\n    color: #1a73e8;\\r\\n    border: 1px solid #dadce0;\\r\\n    border-radius: 5px;\\r\\n    transition: background-color 0.1s;\\r\\n    transition: border-color 0.1s;\\r\\n}\\r\\n\\r\\nbutton:hover {\\r\\n    background-color: #f4f8fe;\\r\\n    color: #1a73e8;\\r\\n    border-color: #1a73e8;\\r\\n    cursor: pointer;\\r\\n}\\r\\n\\r\\n#widthSlider {\\r\\n    width: 100%;\\r\\n}\\r\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\n// css base code, injected by the css-loader\n// eslint-disable-next-line func-names\nmodule.exports = function (cssWithMappingToString) {\n  var list = []; // return the list of modules as css string\n\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = cssWithMappingToString(item);\n\n      if (item[2]) {\n        return \"@media \".concat(item[2], \" {\").concat(content, \"}\");\n      }\n\n      return content;\n    }).join('');\n  }; // import a list of modules into the list\n  // eslint-disable-next-line func-names\n\n\n  list.i = function (modules, mediaQuery, dedupe) {\n    if (typeof modules === 'string') {\n      // eslint-disable-next-line no-param-reassign\n      modules = [[null, modules, '']];\n    }\n\n    var alreadyImportedModules = {};\n\n    if (dedupe) {\n      for (var i = 0; i < this.length; i++) {\n        // eslint-disable-next-line prefer-destructuring\n        var id = this[i][0];\n\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n\n    for (var _i = 0; _i < modules.length; _i++) {\n      var item = [].concat(modules[_i]);\n\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        // eslint-disable-next-line no-continue\n        continue;\n      }\n\n      if (mediaQuery) {\n        if (!item[2]) {\n          item[2] = mediaQuery;\n        } else {\n          item[2] = \"\".concat(mediaQuery, \" and \").concat(item[2]);\n        }\n      }\n\n      list.push(item);\n    }\n  };\n\n  return list;\n};","\"use strict\";\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _iterableToArrayLimit(arr, i) { if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nmodule.exports = function cssWithMappingToString(item) {\n  var _item = _slicedToArray(item, 4),\n      content = _item[1],\n      cssMapping = _item[3];\n\n  if (typeof btoa === 'function') {\n    // eslint-disable-next-line no-undef\n    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping))));\n    var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n    var sourceMapping = \"/*# \".concat(data, \" */\");\n    var sourceURLs = cssMapping.sources.map(function (source) {\n      return \"/*# sourceURL=\".concat(cssMapping.sourceRoot || '').concat(source, \" */\");\n    });\n    return [content].concat(sourceURLs).concat([sourceMapping]).join('\\n');\n  }\n\n  return [content].join('\\n');\n};","\"use strict\";\n\nvar isOldIE = function isOldIE() {\n  var memo;\n  return function memorize() {\n    if (typeof memo === 'undefined') {\n      // Test for IE <= 9 as proposed by Browserhacks\n      // @see http://browserhacks.com/#hack-e71d8692f65334173fee715c222cb805\n      // Tests for existence of standard globals is to allow style-loader\n      // to operate correctly into non-standard environments\n      // @see https://github.com/webpack-contrib/style-loader/issues/177\n      memo = Boolean(window && document && document.all && !window.atob);\n    }\n\n    return memo;\n  };\n}();\n\nvar getTarget = function getTarget() {\n  var memo = {};\n  return function memorize(target) {\n    if (typeof memo[target] === 'undefined') {\n      var styleTarget = document.querySelector(target); // Special case to return head of iframe instead of iframe itself\n\n      if (window.HTMLIFrameElement && styleTarget instanceof window.HTMLIFrameElement) {\n        try {\n          // This will throw an exception if access to iframe is blocked\n          // due to cross-origin restrictions\n          styleTarget = styleTarget.contentDocument.head;\n        } catch (e) {\n          // istanbul ignore next\n          styleTarget = null;\n        }\n      }\n\n      memo[target] = styleTarget;\n    }\n\n    return memo[target];\n  };\n}();\n\nvar stylesInDom = [];\n\nfunction getIndexByIdentifier(identifier) {\n  var result = -1;\n\n  for (var i = 0; i < stylesInDom.length; i++) {\n    if (stylesInDom[i].identifier === identifier) {\n      result = i;\n      break;\n    }\n  }\n\n  return result;\n}\n\nfunction modulesToDom(list, options) {\n  var idCountMap = {};\n  var identifiers = [];\n\n  for (var i = 0; i < list.length; i++) {\n    var item = list[i];\n    var id = options.base ? item[0] + options.base : item[0];\n    var count = idCountMap[id] || 0;\n    var identifier = \"\".concat(id, \" \").concat(count);\n    idCountMap[id] = count + 1;\n    var index = getIndexByIdentifier(identifier);\n    var obj = {\n      css: item[1],\n      media: item[2],\n      sourceMap: item[3]\n    };\n\n    if (index !== -1) {\n      stylesInDom[index].references++;\n      stylesInDom[index].updater(obj);\n    } else {\n      stylesInDom.push({\n        identifier: identifier,\n        updater: addStyle(obj, options),\n        references: 1\n      });\n    }\n\n    identifiers.push(identifier);\n  }\n\n  return identifiers;\n}\n\nfunction insertStyleElement(options) {\n  var style = document.createElement('style');\n  var attributes = options.attributes || {};\n\n  if (typeof attributes.nonce === 'undefined') {\n    var nonce = typeof __webpack_nonce__ !== 'undefined' ? __webpack_nonce__ : null;\n\n    if (nonce) {\n      attributes.nonce = nonce;\n    }\n  }\n\n  Object.keys(attributes).forEach(function (key) {\n    style.setAttribute(key, attributes[key]);\n  });\n\n  if (typeof options.insert === 'function') {\n    options.insert(style);\n  } else {\n    var target = getTarget(options.insert || 'head');\n\n    if (!target) {\n      throw new Error(\"Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.\");\n    }\n\n    target.appendChild(style);\n  }\n\n  return style;\n}\n\nfunction removeStyleElement(style) {\n  // istanbul ignore if\n  if (style.parentNode === null) {\n    return false;\n  }\n\n  style.parentNode.removeChild(style);\n}\n/* istanbul ignore next  */\n\n\nvar replaceText = function replaceText() {\n  var textStore = [];\n  return function replace(index, replacement) {\n    textStore[index] = replacement;\n    return textStore.filter(Boolean).join('\\n');\n  };\n}();\n\nfunction applyToSingletonTag(style, index, remove, obj) {\n  var css = remove ? '' : obj.media ? \"@media \".concat(obj.media, \" {\").concat(obj.css, \"}\") : obj.css; // For old IE\n\n  /* istanbul ignore if  */\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = replaceText(index, css);\n  } else {\n    var cssNode = document.createTextNode(css);\n    var childNodes = style.childNodes;\n\n    if (childNodes[index]) {\n      style.removeChild(childNodes[index]);\n    }\n\n    if (childNodes.length) {\n      style.insertBefore(cssNode, childNodes[index]);\n    } else {\n      style.appendChild(cssNode);\n    }\n  }\n}\n\nfunction applyToTag(style, options, obj) {\n  var css = obj.css;\n  var media = obj.media;\n  var sourceMap = obj.sourceMap;\n\n  if (media) {\n    style.setAttribute('media', media);\n  } else {\n    style.removeAttribute('media');\n  }\n\n  if (sourceMap && typeof btoa !== 'undefined') {\n    css += \"\\n/*# sourceMappingURL=data:application/json;base64,\".concat(btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))), \" */\");\n  } // For old IE\n\n  /* istanbul ignore if  */\n\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    while (style.firstChild) {\n      style.removeChild(style.firstChild);\n    }\n\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nvar singleton = null;\nvar singletonCounter = 0;\n\nfunction addStyle(obj, options) {\n  var style;\n  var update;\n  var remove;\n\n  if (options.singleton) {\n    var styleIndex = singletonCounter++;\n    style = singleton || (singleton = insertStyleElement(options));\n    update = applyToSingletonTag.bind(null, style, styleIndex, false);\n    remove = applyToSingletonTag.bind(null, style, styleIndex, true);\n  } else {\n    style = insertStyleElement(options);\n    update = applyToTag.bind(null, style, options);\n\n    remove = function remove() {\n      removeStyleElement(style);\n    };\n  }\n\n  update(obj);\n  return function updateStyle(newObj) {\n    if (newObj) {\n      if (newObj.css === obj.css && newObj.media === obj.media && newObj.sourceMap === obj.sourceMap) {\n        return;\n      }\n\n      update(obj = newObj);\n    } else {\n      remove();\n    }\n  };\n}\n\nmodule.exports = function (list, options) {\n  options = options || {}; // Force single-tag solution on IE6-9, which has a hard limit on the # of <style>\n  // tags it will allow on a page\n\n  if (!options.singleton && typeof options.singleton !== 'boolean') {\n    options.singleton = isOldIE();\n  }\n\n  list = list || [];\n  var lastIdentifiers = modulesToDom(list, options);\n  return function update(newList) {\n    newList = newList || [];\n\n    if (Object.prototype.toString.call(newList) !== '[object Array]') {\n      return;\n    }\n\n    for (var i = 0; i < lastIdentifiers.length; i++) {\n      var identifier = lastIdentifiers[i];\n      var index = getIndexByIdentifier(identifier);\n      stylesInDom[index].references--;\n    }\n\n    var newLastIdentifiers = modulesToDom(newList, options);\n\n    for (var _i = 0; _i < lastIdentifiers.length; _i++) {\n      var _identifier = lastIdentifiers[_i];\n\n      var _index = getIndexByIdentifier(_identifier);\n\n      if (stylesInDom[_index].references === 0) {\n        stylesInDom[_index].updater();\n\n        stylesInDom.splice(_index, 1);\n      }\n    }\n\n    lastIdentifiers = newLastIdentifiers;\n  };\n};","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => module['default'] :\n\t\t() => module;\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop)","type Type = Number | String | Boolean | Object | UInt8;\r\n\r\nexport class UInt8 { }\r\n\r\nconst ICE_SERVERS: RTCIceServer[] = [\r\n    { urls: 'stun:stun.l.google.com:19302' },\r\n    {\r\n        urls: \"turn:129.213.55.117\",\r\n        username: \"webrtc\",\r\n        credential: \"696969\"\r\n    }\r\n];\r\n\r\nconst PEER_CONNECTION_CONFIG: RTCConfiguration = {\r\n    iceServers: ICE_SERVERS\r\n};\r\n\r\nconst enum MODE {\r\n    SERVER,\r\n    CLIENT\r\n}\r\n\r\nconst SERVER_IP = \"wss.ooley.me\";\r\n\r\nexport interface User {\r\n    objects: Object[],\r\n    rpcLogInd: number;\r\n    tcpCon: RTCDataChannel | null,\r\n    udpCon: RTCDataChannel | null,\r\n    syncing: boolean;\r\n    _peerCon: RTCPeerConnection | null,\r\n    _uuid: string;\r\n}\r\n\r\nexport interface RPC {\r\n    signature: Type[];\r\n    func: Function;\r\n}\r\n\r\nexport interface ObjectTypes {\r\n    signature: Type[];\r\n    constr: Function;\r\n}\r\n\r\nexport class NetworkManager {\r\n\r\n    static _instance: NetworkManager;\r\n    _buffer = new ArrayBuffer(4 * 1024);\r\n    buffer = new DataView(this._buffer);\r\n    rpcs: RPC[] = [{ signature: [], func: () => { } }, { signature: [], func: () => { } }];\r\n    objectTypes: ObjectTypes[] = [{ signature: [], constr: () => { } }];\r\n\r\n    rpcLog: ArrayBuffer[] = [];\r\n    users: (User | null)[] = [null];\r\n    userId = 0;\r\n    mode: MODE = MODE.CLIENT;\r\n    private signalingConnection: WebSocket | null = null;\r\n    private connectingPromise: [Function, Function] | null = null;\r\n    sendLoopTimeout: NodeJS.Timeout | null = null;\r\n    invalid = false;\r\n    lastTime = 0;\r\n\r\n    onUserConnected: (userId: number) => void = (userId) => { console.log(\"User Connected with id\", userId); };\r\n    onUserDisconnected: (userId: number) => void = (userId) => { console.log(\"User Disconnected with id\", userId); };\r\n    onSyncCompleted: () => void = () => { console.log(\"Completed sync\"); };\r\n\r\n    static get instance() {\r\n        if (NetworkManager._instance == null)\r\n            NetworkManager._instance = new NetworkManager;\r\n        return this._instance;\r\n    }\r\n\r\n    async startHost(): Promise<string> {\r\n        this.mode = MODE.SERVER;\r\n        try {\r\n            setTimeout(() => { this.sendLoop(); }, 0);\r\n            return this.setupSignalingServer();\r\n        } catch (error: any) {\r\n            throw new Error(error);\r\n        }\r\n    }\r\n\r\n    private async setupSignalingServer(): Promise<string> {\r\n        return new Promise((resolve, reject) => {\r\n            this.userId = 0;\r\n            let signalCon = new WebSocket(`wss://${SERVER_IP}:80`);\r\n            this.signalingConnection = signalCon;\r\n\r\n            signalCon.onmessage = async (event) => {\r\n                const message = JSON.parse(event.data);\r\n\r\n                try {\r\n                    if (this.mode === MODE.SERVER) { // Server\r\n                        let ind = this.users.findIndex(user => user?._uuid === message.uuid);\r\n\r\n                        if (message.roomCreated) {\r\n                            return resolve(message.roomId);\r\n                        } else if (message.ice) {\r\n                            if (ind === -1) { console.error('Invalid user', message.uuid, this.users); return; }\r\n                            let user = this.users[ind] as User;\r\n\r\n                            if (!user._peerCon) { console.error('Signalling error: No peer con'); return; };\r\n                            await user._peerCon.addIceCandidate(new RTCIceCandidate(message.ice));\r\n                        } else if (this.mode === MODE.SERVER && message.sdpOffer) {\r\n                            if (ind !== -1) { console.error('Signalling error: No peer con'); return; };\r\n\r\n                            let con = new RTCPeerConnection(PEER_CONNECTION_CONFIG);\r\n                            // SETUP TRACKS\r\n                            let user: User = {\r\n                                syncing: true,\r\n                                rpcLogInd: 0,\r\n                                objects: [],\r\n                                tcpCon: null,\r\n                                udpCon: null,\r\n                                _peerCon: con,\r\n                                _uuid: message.uuid\r\n                            };\r\n                            let userId = this.users.length;\r\n                            this.users.push(user);\r\n\r\n                            con.onicecandidate = (event) => {\r\n                                if (event.candidate != null && this.signalingConnection?.readyState === 1) {\r\n                                    this.signalingConnection?.send(JSON.stringify({ ice: event.candidate, uuid: user._uuid, roomId: message.roomId }));\r\n                                } else if (this.mode === MODE.CLIENT) {\r\n                                    // this.signalingConnection?.close();\r\n                                }\r\n                            };\r\n\r\n                            await con.setRemoteDescription(new RTCSessionDescription(message.sdpOffer));\r\n\r\n                            this._setupTracks(user);\r\n\r\n                            if (!user._peerCon) { console.error('Signalling error: No peer con'); return; };\r\n                            await user._peerCon.setLocalDescription(await user._peerCon.createAnswer());\r\n                            signalCon.send(JSON.stringify({ sdpAnswer: user._peerCon.localDescription, uuid: message.uuid, roomId: message.roomId, userId: userId }));\r\n\r\n                            if (!user.tcpCon) { console.error('Signalling error: No tcp con'); return; };\r\n                            if (!user.udpCon) { console.error('Signalling error: No udp con'); return; };\r\n                            let readyHandler = (event: Event) => {\r\n                                if (user.tcpCon?.readyState === 'open' && user.udpCon?.readyState === 'open') { // User Connected\r\n                                    this.invalid = true;\r\n                                }\r\n                            };\r\n\r\n                            user._peerCon.oniceconnectionstatechange = () => {\r\n                                if (user._peerCon?.iceConnectionState == 'disconnected') {\r\n                                    this.disconnectUser(userId);\r\n                                }\r\n                            };\r\n                            user.tcpCon.onopen = readyHandler;\r\n                            user.udpCon.onopen = readyHandler;\r\n                        }\r\n                    } else { // Client\r\n                        let user = this.users[0] as User;\r\n                        if (!user._peerCon) { console.error('Signalling error: No peer con'); return; };\r\n\r\n                        if (message.ice) {\r\n                            user._peerCon.addIceCandidate(new RTCIceCandidate(message.ice));\r\n                        } else if (message.sdpAnswer) {\r\n                            this.userId = message.userId;\r\n                            if (this.connectingPromise) {\r\n                                this.connectingPromise[0](message.roomId);\r\n                                this.connectingPromise = null;\r\n                            }\r\n                            await user._peerCon.setRemoteDescription(new RTCSessionDescription(message.sdpAnswer));\r\n                        }\r\n                    }\r\n                } catch (error) {\r\n                    console.error('Signalling error:', error);\r\n                }\r\n            };\r\n\r\n            signalCon.onclose = () => {\r\n                if (this.mode === MODE.CLIENT && this.connectingPromise) {\r\n                    this.connectingPromise[1](new Error(\"Invalid roomId\"));\r\n                    this.connectingPromise = null;\r\n                    console.error(\"Failed to connect\");\r\n                }\r\n            };\r\n\r\n            signalCon.onerror = (error) => {\r\n                console.error('Websocket error', error);\r\n                if (this.connectingPromise) {\r\n                    this.connectingPromise[1](new Error(\"Websocket error!\"));\r\n                    this.connectingPromise = null;\r\n                }\r\n                reject(new Error(\"Websocket error!\"));\r\n            };\r\n            signalCon.onopen = (_) => {\r\n                if (this.mode === MODE.CLIENT) {\r\n                    resolve(\"\");\r\n                } else {\r\n                    this.signalingConnection?.send(JSON.stringify({ startHost: true }));\r\n                }\r\n            };\r\n        });\r\n    }\r\n\r\n    _setupTracks(user: User) {\r\n        if (!user._peerCon) { return; }\r\n\r\n        // SETUP TRACKS\r\n        user.tcpCon = user._peerCon.createDataChannel('tcp', { ordered: true, negotiated: true, id: 0 });\r\n        user.udpCon = user._peerCon.createDataChannel('udp', { ordered: false, maxRetransmits: 0, negotiated: true, id: 1 });\r\n\r\n        user.tcpCon.binaryType = 'arraybuffer';\r\n\r\n        user.udpCon.binaryType = 'arraybuffer';\r\n        user.udpCon.onmessage = (evt) => { console.log(\"UDP DATA\", evt.data); };\r\n    }\r\n\r\n    connect(roomId: string): Promise<string> {\r\n        return new Promise(async (resolve, reject) => {\r\n            if (this.mode === MODE.SERVER) { return reject(new Error(\"Mode is server!\")); }\r\n            if (this.connectingPromise) { return reject(new Error(\"Already Connecting!\")); }\r\n            this.connectingPromise = [resolve, reject];\r\n\r\n            try {\r\n                await this.setupSignalingServer();\r\n            } catch (error) {\r\n                console.error(\"Connection error:\", error);\r\n                return reject(new Error(\"Failed to create connection!\"));\r\n            }\r\n\r\n            let uuid = this.createUuid();\r\n            let con = new RTCPeerConnection(PEER_CONNECTION_CONFIG);\r\n            let user: User = {\r\n                syncing: true,\r\n                rpcLogInd: 0,\r\n                objects: [],\r\n                tcpCon: null,\r\n                udpCon: null,\r\n                _peerCon: con,\r\n                _uuid: uuid\r\n            };\r\n\r\n            con.onicecandidate = (event) => {\r\n                if (event.candidate != null && this.signalingConnection?.readyState === 1) {\r\n                    this.signalingConnection?.send(JSON.stringify({ ice: event.candidate, uuid: user._uuid, roomId: roomId }));\r\n                } else if (this.mode === MODE.CLIENT) {\r\n                    // this.signalingConnection?.close();\r\n                }\r\n            };\r\n\r\n            this.users[0] = user;\r\n            this._setupTracks(user);\r\n            if (!user._peerCon) { return reject(new Error(\"No peer con!\")); }\r\n            if (!user.tcpCon) { return reject(new Error(\"No peer con!\")); }\r\n            if (!user.udpCon) { return reject(new Error(\"No peer con!\")); }\r\n            let readyHandler = (event: Event) => {\r\n                if (user.tcpCon?.readyState === 'open' && user.udpCon?.readyState === 'open') {\r\n                    this.users[this.userId] = { syncing: true, rpcLogInd: 0, objects: [], tcpCon: null, udpCon: null, _peerCon: null, _uuid: \"\" };\r\n                    this.connectingPromise = null;\r\n                    resolve(roomId);\r\n                }\r\n            };\r\n\r\n            user.tcpCon.onmessage = (evt) => { this._decodeRPC(new DataView(evt.data), 0); };\r\n            user.tcpCon.onopen = readyHandler;\r\n            user.udpCon.onopen = readyHandler;\r\n            await user._peerCon.setLocalDescription(await user._peerCon.createOffer());\r\n            this.signalingConnection?.send(JSON.stringify({ sdpOffer: user._peerCon.localDescription, uuid: uuid, roomId: roomId }));\r\n        });\r\n    }\r\n\r\n    private createUuid(): string {\r\n        function s4() {\r\n            return Math.floor((1 + Math.random()) * 0x10000)\r\n                .toString(16)\r\n                .substring(1);\r\n        }\r\n        return `${s4()}${s4()}-${s4()}-${s4()}-${s4()}-${s4()}${s4()}${s4()}`;\r\n    }\r\n\r\n    spawn(objType: number, ...args: any[]) {\r\n        let obj = this._spawn(this.userId, objType, args);\r\n        this.sendRPC(0, this.encodeRPC(this.userId, objType, 0, args));\r\n        return obj;\r\n    }\r\n\r\n    private _spawn(userId: number, objType: number, args: any[]) {\r\n        let user = this.users[userId];\r\n        if (!user) return null;\r\n        let obj = new (this.objectTypes[objType].constr as any)(...args);\r\n        console.log(\"created\", obj);\r\n        user.objects.push(obj);\r\n        obj._objId = user.objects.length - 1;\r\n        obj._ownerId = userId;\r\n        if (obj.onSpawn) { obj.onSpawn(); }\r\n        return obj;\r\n    }\r\n\r\n    registerRPC(fn: Function, args: Type[]) {\r\n        this.rpcs.push({ func: fn, signature: args });\r\n        return this.rpcs.length - 1;\r\n    }\r\n\r\n    registerNetworkedObject(objConstr: Function, args: Type[]) {\r\n        this.objectTypes.push({ signature: args, constr: objConstr });\r\n        objConstr.prototype._classId = this.objectTypes.length - 1;\r\n        return this.objectTypes.length - 1;\r\n    }\r\n\r\n    sendRPC(to: number, data: DataView) {\r\n        let user = this.users[to];\r\n        if (!user || user.tcpCon?.readyState !== \"open\") return;\r\n        user.tcpCon.send(data);\r\n    }\r\n\r\n    sendRPCAll(data: DataView) {\r\n        if (this.mode !== MODE.SERVER) { return; }\r\n        this.rpcLog.push(data.buffer.slice(data.byteOffset, data.byteLength));\r\n        this.invalid = true;\r\n    }\r\n\r\n    sendLoop() {\r\n        if (this.invalid) {\r\n            this.invalid = false;\r\n\r\n            for (let i = 0; i < this.users.length; i++) {\r\n                let user = this.users[i];\r\n                if (!user || user.tcpCon?.readyState !== \"open\") continue;\r\n\r\n                let amt = 0;\r\n                for (let j = user.rpcLogInd; j < this.rpcLog.length; j++) {\r\n                    if (user.tcpCon.bufferedAmount > 10000) { this.invalid = true; break; }\r\n\r\n                    amt += this.rpcLog[j].byteLength;\r\n                    user.tcpCon.send(this.rpcLog[j]);\r\n                    user.rpcLogInd++;\r\n                }\r\n\r\n                if (user.syncing && user.rpcLogInd === this.rpcLog.length) {\r\n                    user.syncing = false;\r\n                    console.log(\"User\", i, \"Synced\");\r\n                    user.tcpCon.onmessage = (evt) => { this._decodeRPC(new DataView(evt.data), i); };\r\n                    this.onUserConnected(i);\r\n                    this.sendRPCAll(this.encodeRPC(i, 0, 0, [])); // Send on user connected\r\n                }\r\n            }\r\n        }\r\n        setTimeout(() => { this.sendLoop(); }, 0);\r\n    }\r\n\r\n    encodeRPC(ownerId: number, objId: number, rpcId: number, args: any) {\r\n        this.buffer.setUint8(0, ownerId);\r\n        this.buffer.setUint8(1, rpcId);\r\n        this.buffer.setUint16(2, objId, true);\r\n        let length = this._writeToBuf(this.rpcs[rpcId].signature, 4, args);\r\n        return new DataView(this._buffer, 0, length);\r\n    }\r\n\r\n    private disconnectUser(userId: number) {\r\n        this.sendRPCAll(this.encodeRPC(userId, 0, 1, []));\r\n        this.onUserDisconnected(userId);\r\n        this.users[userId]?._peerCon?.close();\r\n        this.users[userId] = null;\r\n    }\r\n\r\n    private _decodeRPC(data: DataView, callingUserId: number) {\r\n        let userId = data.getUint8(0);\r\n        let rpcId = data.getUint8(1);\r\n        let objId = data.getUint16(2, true);\r\n        let args: any[] = [];\r\n\r\n        if (rpcId === 0) { // Spawn\r\n            if (objId === 0) {// User Connected\r\n                if (this.mode === MODE.SERVER) { // Invalid command, kick client\r\n                    this.disconnectUser(callingUserId);\r\n                    return;\r\n                }\r\n\r\n                if (userId === this.userId) { console.log(\"Connected\"); this.onSyncCompleted(); return; }\r\n                this.users[userId] = { syncing: true, rpcLogInd: 0, objects: [], tcpCon: null, udpCon: null, _peerCon: null, _uuid: \"\" };\r\n                this.onUserConnected(userId);\r\n            } else {\r\n                if (userId === this.userId) { return; }\r\n                if (this.mode === MODE.SERVER) { this.sendRPCAll(data); }\r\n\r\n                this._readFromBuf(this.objectTypes[objId].signature, 4, data, args);\r\n                this._spawn(userId, objId, args);\r\n            }\r\n        } else if (rpcId === 1) { // Destroy\r\n            if (objId === 0) {// User Disconnected\r\n                if (this.mode === MODE.SERVER) { // Invalid command, kick client\r\n                    this.disconnectUser(callingUserId);\r\n                    return;\r\n                }\r\n                this.onUserDisconnected(userId);\r\n                this.users[userId] = null;\r\n            } else {\r\n                if (userId === this.userId) { return; }\r\n                if (this.mode === MODE.SERVER) { this.sendRPCAll(data); }\r\n\r\n                this._readFromBuf(this.objectTypes[objId].signature, 4, data, args);\r\n                this._spawn(userId, objId, args);\r\n            }\r\n        } else {\r\n            let user = this.users[userId];\r\n            if (!user) {\r\n                if (this.mode === MODE.SERVER) { this.disconnectUser(callingUserId); }\r\n                return;\r\n            }\r\n            this._readFromBuf(this.rpcs[rpcId].signature, 4, data, args);\r\n            this.rpcs[rpcId].func.call(user.objects[objId], ...args);\r\n        }\r\n    }\r\n\r\n    private _readFromBuf(types: Type[], ind: number, data: DataView, output: any[]): number {\r\n        for (let i = 0; i < types.length; i++) {\r\n            if (types[i] instanceof Array) {\r\n                let count = data.getFloat64(ind, true);\r\n                ind += 8;\r\n                let items: any[] = [];\r\n\r\n                for (let j = 0; j < count; j++) {\r\n                    ind = this._readFromBuf([(types[i] as Type[])[0]], ind, data, items);\r\n                }\r\n\r\n                output.push(items);\r\n                continue;\r\n            }\r\n\r\n            switch (types[i]) {\r\n                case UInt8:\r\n                    output.push(data.getUint8(ind));\r\n                    ind += 1;\r\n                    break;\r\n\r\n                case Number:\r\n                    output.push(data.getFloat64(ind, true));\r\n                    ind += 8;\r\n                    break;\r\n\r\n                case Boolean:\r\n                    output.push(data.getUint8(ind) === 1);\r\n                    ind += 1;\r\n                    break;\r\n\r\n                case String:\r\n                    let s = \"\";\r\n                    while (data.getUint16(ind, true)) {\r\n                        s += String.fromCharCode(data.getUint16(ind, true));\r\n                        ind += 2;\r\n                    }\r\n                    output.push(s);\r\n                    ind += 2;\r\n                    break;\r\n\r\n                case Object:\r\n                    ind = this._readFromBuf([String], ind, data, output);\r\n                    output[output.length - 1] = JSON.parse(output[output.length - 1]);\r\n                    break;\r\n\r\n                default:\r\n                    console.error(\"Unsupported Type\");\r\n                    break;\r\n            }\r\n        }\r\n        return ind;\r\n    }\r\n\r\n    private _writeToBuf(types: Type[], ind: number, data: any[]): number {\r\n        for (let i = 0; i < types.length; i++) {\r\n            if (types[i] instanceof Array) {\r\n                this.buffer.setFloat64(ind, (data[i] as []).length, true);\r\n                ind += 8;\r\n\r\n                for (let j = 0; j < (data[i] as []).length; j++) {\r\n                    ind = this._writeToBuf([(types[i] as Type[])[0]], ind, [data[i][j]]);\r\n                }\r\n                continue;\r\n            }\r\n\r\n            switch (types[i]) {\r\n                case UInt8:\r\n                    this.buffer.setUint8(ind, data[i]);\r\n                    ind += 1;\r\n                    break;\r\n\r\n                case Number:\r\n                    this.buffer.setFloat64(ind, data[i], true);\r\n                    ind += 8;\r\n                    break;\r\n\r\n                case Boolean:\r\n                    this.buffer.setUint8(ind, data[i] ? 1 : 0);\r\n                    ind += 1;\r\n                    break;\r\n\r\n                case String:\r\n                    for (let j = 0; j < (data[i] as string).length; j++) {\r\n                        this.buffer.setUint16(ind, data[i].charCodeAt(j), true);\r\n                        ind += 2;\r\n                    }\r\n                    this.buffer.setUint16(ind, 0, true);\r\n                    ind += 2;\r\n                    break;\r\n\r\n                case Object:\r\n                    ind = this._writeToBuf([String], ind, [JSON.stringify(data[i])]);\r\n                    break;\r\n\r\n                default:\r\n                    console.error(\"Unsupported Type\");\r\n                    break;\r\n            }\r\n        }\r\n        return ind;\r\n    }\r\n}\r\n\r\nexport function Replicated(...types: Type[]) {\r\n    return function <T extends { new(...args: any[]): {}; }>(constr: T) {\r\n        let orig = constr;\r\n        let manager = NetworkManager.instance;\r\n        let id = manager.registerNetworkedObject(constr, types);\r\n        let newConst = function (...args: any[]) {\r\n            return manager.spawn(id, args);\r\n        };\r\n\r\n        newConst.prototype = orig.prototype;\r\n        return newConst as any as T;\r\n    };\r\n}\r\n\r\nexport function Watched(arg: Type) {\r\n    return function (target: any, propertyKey: string) {\r\n        Object.defineProperty(target, propertyKey, {\r\n            get: function () {\r\n                return this[\"_\" + propertyKey];\r\n            },\r\n            set: function (test) {\r\n                this[\"_\" + propertyKey] = test;\r\n            }\r\n        });\r\n    };\r\n}\r\n\r\n// export function RPC(...types: Type[]) {\r\n//     return function (target: any, propertyKey: string, descriptor: PropertyDescriptor) {\r\n\r\n//         let orig = descriptor.value;\r\n//         let id = NetworkManager.instance.registerRPC(orig, types);\r\n//         descriptor.value = function (...args: any[]) {\r\n//             orig(...args);\r\n//             NetworkManager.instance.sendRPC((this as any)._objId, id, args);\r\n//         }\r\n//     }\r\n// }\r\n\r\nexport function ClientRPC(...types: Type[]) {\r\n    return function (target: any, propertyKey: string, descriptor: PropertyDescriptor) {\r\n\r\n        let manager = NetworkManager.instance;\r\n        let orig = descriptor.value;\r\n        let id = manager.registerRPC(orig, types);\r\n        descriptor.value = function (...args: any[]) {\r\n            if (manager.mode === MODE.CLIENT) { return; }\r\n            manager.sendRPCAll(manager.encodeRPC((this as any)._ownerId, (this as any)._objId, id, args));\r\n        };\r\n    };\r\n}\r\n\r\nexport function ServerRPC(...types: Type[]) {\r\n    return function (target: any, propertyKey: string, descriptor: PropertyDescriptor) {\r\n\r\n        let manager = NetworkManager.instance;\r\n        let orig = descriptor.value;\r\n        let id = manager.registerRPC(orig, types);\r\n        descriptor.value = function (...args: any[]) {\r\n            if (manager.mode === MODE.SERVER) { return; }\r\n            manager.sendRPC(0, manager.encodeRPC(manager.userId, (this as any)._objId, id, args));\r\n        };\r\n    };\r\n}\r\n\r\nexport function IRPC(...types: Type[]) {\r\n    return function (target: any, propertyKey: string, descriptor: PropertyDescriptor) {\r\n\r\n        let manager = NetworkManager.instance;\r\n        let orig = descriptor.value;\r\n        let newFun = function (...args: any[]) {\r\n            //@ts-ignore\r\n            if (this._ownerId !== manager.userId) { orig.call(this, ...args); }\r\n        };\r\n\r\n        let clientId = manager.registerRPC(newFun, types);\r\n        descriptor.value = function (...args: any[]) {\r\n            if (manager.mode === MODE.SERVER) { return; }\r\n            orig.call(this, ...args);\r\n            manager.sendRPC(0, manager.encodeRPC(manager.userId, (this as any)._objId, serverId, args));\r\n        };\r\n\r\n        let serverFn = function (...args: any[]) {\r\n            if (manager.mode === MODE.CLIENT) { return; }\r\n            //@ts-ignore\r\n            manager.sendRPCAll(manager.encodeRPC(this._ownerId, this._objId, clientId, args));\r\n        };\r\n        let serverId = manager.registerRPC(serverFn, types);\r\n    };\r\n}\r\n\r\nexport function RPC(...types: Type[]) {\r\n    return function (target: any, propertyKey: string, descriptor: PropertyDescriptor) {\r\n\r\n        let manager = NetworkManager.instance;\r\n        let orig = descriptor.value;\r\n\r\n        let clientId = manager.registerRPC(orig, types);\r\n        descriptor.value = function (...args: any[]) {\r\n            if (manager.mode === MODE.SERVER) { return; }\r\n            manager.sendRPC(0, manager.encodeRPC(manager.userId, (this as any)._objId, serverId, args));\r\n        };\r\n\r\n        let serverFn = function (...args: any[]) {\r\n            if (manager.mode === MODE.CLIENT) { return; }\r\n            //@ts-ignore\r\n            manager.sendRPCAll(manager.encodeRPC(this._ownerId, this._objId, clientId, args));\r\n        };\r\n        let serverId = manager.registerRPC(serverFn, types);\r\n    };\r\n}\r\n","export class Vec2 {\r\n    constructor(public x: number, public y: number) { }\r\n\r\n    add(x: Vec2) {\r\n        return new Vec2(this.x + x.x, this.y + x.y);\r\n    }\r\n\r\n    i_add(x: Vec2) {\r\n        this.x += x.x;\r\n        this.y += x.y;\r\n    }\r\n\r\n    div(x: Vec2) {\r\n        return new Vec2(this.x / x.x, this.y / x.y);\r\n    }\r\n\r\n    i_div(x: Vec2) {\r\n        this.x /= x.x;\r\n        this.y /= x.y;\r\n    }\r\n\r\n    div_s(x: number) {\r\n        return new Vec2(this.x / x, this.y / x);\r\n    }\r\n\r\n    i_div_s(x: number) {\r\n        this.x /= x;\r\n        this.y /= x;\r\n    }\r\n\r\n    sqr_dist(x: Vec2) {\r\n        let dx = this.x - x.x;\r\n        let dy = this.y - x.y;\r\n        return dx * dx + dy * dy;\r\n    }\r\n}\r\n\r\nexport class Color {\r\n    constructor(public r: number, public g: number, public b: number) { }\r\n\r\n    lerp(x: Color, t: number) {\r\n        return new Color(lerp(this.r, x.r, t), lerp(this.g, x.g, t), lerp(this.b, x.b, t));\r\n    }\r\n\r\n    toColorString() {\r\n        return `rgb(${this.r},${this.g},${this.b})`;\r\n    }\r\n}\r\n\r\n\r\nexport function lerp(min: number, max: number, t: number) {\r\n    return min + (max - min) * t;\r\n}\r\n\r\nexport function bezierBlend(t: number) {\r\n    return t * t * (3.0 - 2.0 * t);\r\n}\r\n\r\nexport function parametricBlend(t: number) {\r\n    let sqt = t * t;\r\n    return sqt / (2.0 * (sqt - t) + 1.0);\r\n}\r\n\r\nexport function easeIn(t: number) {\r\n    return 2.0 * t * t;\r\n}\r\n\r\nexport function easeOut(t: number) {\r\n    return 2.0 * t * (1.0 - t) + 0.5;\r\n}\r\n\r\nexport function inOutQuadBlend(t: number) {\r\n    if (t <= 0.5) return 2.0 * t * t;\r\n    t -= 0.5;\r\n    return 2.0 * t * (1.0 - t) + 0.5;\r\n}","import { Vec2 } from \"./util\";\r\n\r\nfunction PointLineDistance(point: Vec2, p1: Vec2, p2: Vec2): number {\r\n    let t = 0;\r\n    let segmentLength = p1.sqr_dist(p2);\r\n\r\n    if (segmentLength === 0) {\r\n        t = point.sqr_dist(p1);\r\n    } else {\r\n        t = ((point.x - p1.x) * (p2.x - p1.x) +\r\n            (point.y - p1.y) * (p2.y - p1.y)) / segmentLength;\r\n    }\r\n\r\n    if (t < 0) { return Math.sqrt(point.sqr_dist(p1)); }\r\n    if (t > 1) { return Math.sqrt(point.sqr_dist(p2)); }\r\n    return Math.sqrt(point.sqr_dist(new Vec2(\r\n        p1.x + t * (p2.x - p1.x),\r\n        p1.y + t * (p2.y - p1.y)\r\n    )));\r\n}\r\n\r\nfunction _DouglasPeucker(points: Vec2[], startIndex: number, lastIndex: number, epsilon: number) {\r\n    let stk: [number, number][] = [];\r\n    stk.push([startIndex, lastIndex]);\r\n\r\n    let globalStartIndex = startIndex;\r\n    let bitArray = new Array(lastIndex - startIndex + 1).fill(true);\r\n\r\n    while (stk.length > 0) {\r\n        let pair = stk.pop() as [number, number];\r\n        startIndex = pair[0];\r\n        lastIndex = pair[1];\r\n\r\n        let dmax = 0;\r\n        let index = startIndex;\r\n\r\n        for (let i = index + 1; i < lastIndex; ++i) {\r\n            if (bitArray[i - globalStartIndex]) {\r\n                let d = PointLineDistance(points[i], points[startIndex], points[lastIndex]);\r\n\r\n                if (d > dmax) {\r\n                    index = i;\r\n                    dmax = d;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (dmax > epsilon) {\r\n            stk.push([startIndex, index]);\r\n            stk.push([index, lastIndex]);\r\n        }\r\n        else {\r\n            for (let i = startIndex + 1; i < lastIndex; ++i) {\r\n                bitArray[i - globalStartIndex] = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    return bitArray;\r\n}\r\n\r\nexport function DouglasPeucker(points: Vec2[], epsilon: number): Vec2[] {\r\n    let bitArray = _DouglasPeucker(points, 0, points.length - 1, epsilon);\r\n    let resList = [];\r\n\r\n    for (let i = 0, n = points.length; i < n; ++i) {\r\n        if (bitArray[i]) {\r\n            resList.push(points[i]);\r\n        }\r\n    }\r\n    return resList;\r\n}","import api from \"!../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n            import content from \"!!../node_modules/css-loader/dist/cjs.js!./roomStyle.css\";\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nexport default content.locals || {};","import adapter from 'webrtc-adapter';\r\nimport { NetworkManager, RPC, Watched, Replicated, ClientRPC, ServerRPC, IRPC, UInt8 } from \"./networkManager\";\r\nimport { Vec2, Color } from \"./util\";\r\nimport { DouglasPeucker } from \"./dp_iter\";\r\nimport './roomStyle.css';\r\n\r\nconst canvas = document.getElementById(\"paint-board\") as HTMLCanvasElement;\r\nconst context = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n// const chatInput: HTMLInputElement = document.getElementById(\"chatInput\") as HTMLInputElement;\r\n// const chatbox: HTMLDivElement = document.getElementById(\"chatbox\") as HTMLDivElement;\r\n\r\nconst colors = [\r\n    new Color(94, 189, 62),\r\n    new Color(255, 185, 0),\r\n    new Color(247, 130, 0),\r\n    new Color(226, 56, 56),\r\n    new Color(151, 57, 153),\r\n    new Color(0, 156, 223),\r\n];\r\n\r\nconst COLOR_SWITCH_TIME = 750; // MS\r\nconst SMOOTHING_SAMPLES = 3;\r\nlet manager: DrawingManager | null = null;\r\n\r\nlet setup = () => {\r\n    canvas.width = window.innerWidth;\r\n    canvas.height = window.innerHeight;\r\n    context.lineJoin = \"round\";\r\n    context.lineCap = \"round\";\r\n    context.lineWidth = 2;\r\n};\r\n\r\nwindow.addEventListener(\"resize\", setup);\r\nsetup();\r\n\r\n\r\nexport class Stroke {\r\n    points: Vec2[] = [];\r\n    isDrawing: boolean = false;\r\n    colorInd: number = 0;\r\n    colorTime: number = 0;\r\n\r\n    constructor(public color: Color, public width: number = 1, public rainbow: boolean = false) { }\r\n\r\n    draw(dt: number) {\r\n        if (this.rainbow) {\r\n            let col = colors[(this.colorInd) % colors.length];\r\n            let nextCol = colors[(this.colorInd + 1) % colors.length];\r\n            let t = this.colorTime / COLOR_SWITCH_TIME;\r\n            context.strokeStyle = col.lerp(nextCol, t).toColorString();\r\n            this.colorTime += dt;\r\n            while (this.colorTime >= COLOR_SWITCH_TIME) {\r\n                this.colorTime -= COLOR_SWITCH_TIME;\r\n                this.colorInd = (this.colorInd + 1) % colors.length;\r\n            }\r\n        } else {\r\n            context.strokeStyle = this.color.toColorString();\r\n        }\r\n\r\n        context.lineWidth = this.width;\r\n\r\n        if (this.points.length > 1) {\r\n            context.beginPath();\r\n            context.moveTo(this.points[0].x, this.points[0].y);\r\n            for (let i = 1; i < this.points.length; i++) {\r\n                context.lineTo(this.points[i].x, this.points[i].y);\r\n            }\r\n            context.stroke();\r\n        }\r\n    }\r\n\r\n    mouseDown(x: number, y: number) {\r\n        this.isDrawing = true;\r\n        this._addPoint(x, y);\r\n    }\r\n\r\n    mouseUp(x: number, y: number) {\r\n        this.isDrawing = false;\r\n        this._addPoint(x, y);\r\n\r\n        for (let i = 0; i < SMOOTHING_SAMPLES; i++) {\r\n            this.smooth(this.points.length - 1 + (i - SMOOTHING_SAMPLES));\r\n        }\r\n\r\n        this.points = DouglasPeucker(this.points, 0.5);\r\n    }\r\n\r\n    mouseMove(x: number, y: number) {\r\n        if (this.isDrawing) {\r\n            this._addPoint(x, y);\r\n        }\r\n    }\r\n\r\n    private _addPoint(x: number, y: number) {\r\n        this.points.push(new Vec2(x, y));\r\n        this.smooth(this.points.length - 1 - SMOOTHING_SAMPLES);\r\n    }\r\n\r\n    smooth(ind: number) {\r\n        if (ind < 0 || ind >= this.points.length) return;\r\n\r\n        let point = this.points[ind];\r\n        let samples = 1;\r\n\r\n        for (\r\n            let i = Math.max(ind - SMOOTHING_SAMPLES, 0);\r\n            i < ind;\r\n            i++\r\n        ) {\r\n            point.i_add(this.points[i]);\r\n            samples++;\r\n        }\r\n\r\n        for (\r\n            let i = ind + 1;\r\n            i <= Math.floor(Math.min(ind + SMOOTHING_SAMPLES, this.points.length - 1));\r\n            i++\r\n        ) {\r\n            point.i_add(this.points[i]);\r\n            samples++;\r\n        }\r\n\r\n        point.i_div_s(samples);\r\n    }\r\n}\r\n\r\nlet lastTime = 0;\r\nlet managers: DrawingManager[] = [];\r\nlet renderLoop = (timestamp: number) => {\r\n    let dt = timestamp - lastTime;\r\n    lastTime = timestamp;\r\n\r\n    context.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    for (let i = 0; i < managers.length; i++) {\r\n        managers[i].renderLoop(dt);\r\n    }\r\n\r\n    requestAnimationFrame(renderLoop);\r\n};\r\n\r\n@Replicated()\r\nexport class DrawingManager {\r\n    paths: Stroke[] = [];\r\n    activePath: Stroke | null = null;\r\n    widthSlider: HTMLInputElement | null = null;\r\n    colorInput: HTMLInputElement | null = null;\r\n    rainbowButton: HTMLButtonElement | null = null;\r\n    mousePos = new Vec2(0, 0);\r\n    rainbow = false;\r\n\r\n    onSpawn() {\r\n        console.log(\"OBJID\", (this as any)._ownerId, NetworkManager.instance.userId, this);\r\n        if ((this as any)._ownerId === NetworkManager.instance.userId) {\r\n            canvas.addEventListener(\"pointerdown\", (event) => { this.mouseDown(event.offsetX, event.offsetY); });\r\n            canvas.addEventListener(\"pointerup\", (event) => { this.mouseUp(event.offsetX, event.offsetY); });\r\n            canvas.addEventListener(\"pointerout\", (event) => { this.mouseUp(event.offsetX, event.offsetY); });\r\n            canvas.addEventListener(\"pointermove\", (event) => {\r\n                //@ts-ignore\r\n                if (event.getCoalescedEvents) {\r\n                    //@ts-ignore\r\n                    let events = event.getCoalescedEvents();\r\n                    for (let i = 0; i < events.length; i++) {\r\n                        this.mouseMove(events[i].offsetX, events[i].offsetY);\r\n                    }\r\n                } else {\r\n                    this.mouseMove(event.offsetX, event.offsetY);\r\n                }\r\n            });\r\n\r\n            this.colorInput = document.getElementById(\"lineCol\") as HTMLInputElement;\r\n            this.widthSlider = document.getElementById(\"widthSlider\") as HTMLInputElement;\r\n            this.rainbowButton = document.getElementById(\"rainbow\") as HTMLButtonElement;\r\n\r\n            this.rainbowButton.onclick = () => { this.toggleRainbow(); };\r\n            this.colorInput.onclick = () => { if (this.rainbow) { this.toggleRainbow(); } }\r\n            (document.getElementById(\"undo\") as HTMLButtonElement).onclick = () => {\r\n                this.undo();\r\n            };\r\n            // (document.getElementById(\"sendMessage\") as HTMLFormElement).onclick = (event) => {\r\n            //     event.preventDefault();\r\n            //     this.sendMessage(chatInput.value);\r\n            //     chatInput.value = \"\";\r\n            // };\r\n            (document.getElementById(\"clear\") as HTMLButtonElement).onclick = () => {\r\n                this.clear();\r\n            };\r\n            document.addEventListener('keydown', (event) => {\r\n                if (event.ctrlKey && event.key === 'z') {\r\n                    this.undo();\r\n                }\r\n            });\r\n            managers.push(this);\r\n        } else {\r\n            if (managers.length === 0) {\r\n                managers.push(this);\r\n            } else {\r\n                managers.splice(managers.length - 1, 0, this);\r\n            }\r\n        }\r\n    }\r\n\r\n    toggleRainbow() {\r\n        if (this.rainbow) {\r\n            this.rainbowButton?.classList.remove(\"rainbowOn\");\r\n            this.rainbow = false;\r\n        } else {\r\n            this.rainbowButton?.classList.add(\"rainbowOn\");\r\n            this.rainbow = true;\r\n        }\r\n    }\r\n\r\n    @IRPC(Number, Number, Number, UInt8, UInt8, UInt8, Boolean)\r\n    newPath(x: number, y: number, width: number, r: number, g: number, b: number, rainbow: boolean) {\r\n        this.activePath = new Stroke(new Color(r, g, b), width, rainbow);\r\n        this.paths.push(this.activePath);\r\n        this.activePath.mouseDown(x, y);\r\n    }\r\n\r\n    @IRPC(Number, Number)\r\n    mouseMove(x: number, y: number) {\r\n        this.mousePos.x = x;\r\n        this.mousePos.y = y;\r\n        if (!this.activePath) return;\r\n        this.activePath.mouseMove(x, y);\r\n    }\r\n\r\n    mouseDown(x: number, y: number) {\r\n        let col = this.colorInput?.value || \"#000000\";\r\n        let width = 1;\r\n\r\n        if (this.widthSlider) {\r\n            width = parseInt(this.widthSlider.value);\r\n        }\r\n        this.newPath(x, y, width, parseInt(col.substr(1, 2), 16), parseInt(col.substr(3, 2), 16), parseInt(col.substr(5, 2), 16), this.rainbow);\r\n    }\r\n\r\n    @IRPC()\r\n    clear() {\r\n        this.paths = [];\r\n    }\r\n\r\n    @IRPC()\r\n    undo() {\r\n        this.paths.pop();\r\n    }\r\n\r\n    // @IRPC(String)\r\n    // sendMessage(message: string) {\r\n    //     let div = document.createElement(\"div\");\r\n    //     div.textContent = message;\r\n    //     chatbox.append(div);\r\n    // }\r\n\r\n    @IRPC(Number, Number)\r\n    mouseUp(x: number, y: number) {\r\n        if (!this.activePath) return;\r\n        this.activePath.mouseUp(x, y);\r\n        this.activePath = null;\r\n    }\r\n\r\n    renderLoop(dt: number) {\r\n        for (let i = 0; i < this.paths.length; i++) {\r\n            this.paths[i].draw(dt);\r\n        }\r\n        if ((this as any)._ownerId !== NetworkManager.instance.userId) {\r\n            context.beginPath();\r\n            context.fillStyle = \"#000000\";\r\n            context.arc(this.mousePos.x, this.mousePos.y, 5, 0, Math.PI * 2);\r\n            context.fill();\r\n        }\r\n    };\r\n}\r\n\r\nlet statusDiv = document.getElementById(\"status\") as HTMLElement;\r\nlet preloader = document.getElementById(\"preloader\") as HTMLElement;\r\nlet controls = document.getElementById(\"controls\") as HTMLElement;\r\nlet hostIFrame: HTMLIFrameElement | null = null;\r\n\r\n// @ts-ignore\r\nwindow.startHost = function (isNew: boolean) {\r\n    if (isNew) {\r\n        if (!hostIFrame) {\r\n            hostIFrame = document.createElement(\"iframe\");\r\n            hostIFrame.src = window.location.href;\r\n            hostIFrame.style.display = \"none\";\r\n            document.body.append(hostIFrame);\r\n            hostIFrame.onload = () => {\r\n                // @ts-ignore\r\n                hostIFrame.contentWindow?.startHost();\r\n            }\r\n        } else {\r\n            hostIFrame.contentWindow?.location.reload();\r\n        }\r\n    } else {\r\n        NetworkManager.instance.startHost().then((roomId: string) => {\r\n            console.log(\"STARTED AS HOST WITH ROOM ID\", roomId);\r\n            // @ts-ignore\r\n            window.parent.startedHost(roomId);\r\n        });\r\n    }\r\n}\r\n\r\n// @ts-ignore\r\nwindow.startClient = function (roomId) {\r\n    console.log('ROOMID', roomId);\r\n    statusDiv.textContent = \"Connecting...\";\r\n    NetworkManager.instance.connect(roomId).then((roomId) => {\r\n        console.log('CONNECTED');\r\n        // roomIdInput.value = roomId;\r\n        statusDiv.textContent = roomId;\r\n        statusDiv.onclick = () => {\r\n            navigator.clipboard.writeText(`http://${window.location.hostname}/room?roomId=${roomId}`).then(function () {\r\n                console.log('Async: Copying to clipboard was successful!');\r\n            }, function (err) {\r\n                console.error('Async: Could not copy text: ', err);\r\n            });\r\n        }\r\n        statusDiv.click();\r\n        NetworkManager.instance.onSyncCompleted = () => {\r\n            console.log(\"Synced\");\r\n            canvas.classList.add(\"visible\");\r\n            controls.classList.add(\"visible\");\r\n            preloader.classList.add(\"hidden\");\r\n            manager = new DrawingManager();\r\n            requestAnimationFrame(renderLoop);\r\n        };\r\n    }).catch(err => {\r\n        statusDiv.textContent = \"Failed to connect\";\r\n    });\r\n};\r\n\r\n// @ts-ignore\r\nwindow.startedHost = (roomId) => {\r\n    console.log(\"LOCATION\", window.location.hostname);\r\n    // @ts-ignore\r\n    window.startClient(roomId);\r\n}\r\n\r\nwindow.onload = () => {\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    const isHost = urlParams.get('isHost');\r\n    const roomId = urlParams.get('roomId');\r\n    const name = localStorage.getItem('username') || \"Guest\";\r\n\r\n    if (isHost) {\r\n        // @ts-ignore\r\n        window.startHost(true);\r\n    } else if (roomId) {\r\n        // @ts-ignore\r\n        window.startClient(roomId);\r\n    } else {\r\n        statusDiv.textContent = \"Invalid Room ID\";\r\n    }\r\n};"],"sourceRoot":""}